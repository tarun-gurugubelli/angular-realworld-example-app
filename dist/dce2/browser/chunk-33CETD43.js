import{a as ot}from"./chunk-LJL2VTHK.js";import{a as rt,b as lt}from"./chunk-CLUI7Q6N.js";import{a as gt}from"./chunk-F2L3Y25F.js";import"./chunk-PPTD6DWY.js";import{a as ct,c as mt,d as st,f as pt,g as dt,h as ut,i as _t,l as ft,m as vt,n as Ct}from"./chunk-SRQIWDXQ.js";import{a as at}from"./chunk-RHCJJ7XN.js";import{$ as q,$a as it,Aa as m,Ba as Q,Ca as v,Fa as V,Ga as R,Ha as h,Ja as b,K as H,Ka as A,La as X,N as O,O as y,P as T,Qa as Y,S as G,Sa as I,Ta as Z,U as u,V as _,Va as tt,Z as W,Za as et,aa as J,ba as K,bb as nt,ca as k,cb as D,da as r,ea as S,fb as L,gb as E,i as B,k as w,l as z,la as g,ma as c,oa as x,pa as M,qa as U,ra as j,sa as a,t as P,ta as l,ua as d,va as C,wa as f,xa as p}from"./chunk-LMBD4G5S.js";import{d as $}from"./chunk-77EUENG2.js";var ht=(()=>{let o=class o{constructor(){this.domSanitizer=y(et)}transform(n){return $(this,null,function*(){let{marked:i}=yield import("./chunk-BMZ7FOT5.js");return this.domSanitizer.sanitize(J.HTML,i.parse(n))||""})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275pipe=G({name:"markdown",type:o,pure:!0,standalone:!0});let e=o;return e})();var xt=e=>["/profile",e];function Et(e,o){if(e&1){let t=C();a(0,"span",7)(1,"i",8),f("click",function(){u(t);let i=p(2);return _(i.delete.emit(!0))}),l()()}}function Ft(e,o){if(e&1&&(a(0,"div",0)(1,"div",1)(2,"p",2),m(3),l()(),a(4,"div",3)(5,"a",4),d(6,"img",5),l(),m(7," \xA0 "),a(8,"a",4),m(9),l(),a(10,"span",6),m(11),b(12,"date"),l(),g(13,Et,2,0,"span",7),b(14,"async"),l()()),e&2){let t=p();r(3),v(" ",t.comment.body," "),r(2),c("routerLink",h(12,xt,t.comment.author.username)),r(),c("src",t.comment.author.image,k),r(2),c("routerLink",h(14,xt,t.comment.author.username)),r(),v(" ",t.comment.author.username," "),r(2),v(" ",X(12,7,t.comment.createdAt,"longDate")," "),r(2),x(A(14,10,t.canModify$)?13:-1)}}var yt=(()=>{let o=class o{constructor(){this.delete=new q,this.canModify$=y(L).currentUser.pipe(w(n=>n?.username===this.comment.author.username))}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=T({type:o,selectors:[["app-article-comment"]],inputs:{comment:"comment"},outputs:{delete:"delete"},standalone:!0,features:[V],decls:1,vars:1,consts:[[1,"card"],[1,"card-block"],[1,"card-text"],[1,"card-footer"],[1,"comment-author",3,"routerLink"],[1,"comment-author-img",3,"src"],[1,"date-posted"],[1,"mod-options"],[1,"ion-trash-a",3,"click"]],template:function(i,s){i&1&&g(0,Ft,15,16,"div",0),i&2&&x(s.comment?0:-1)},dependencies:[D,Z,I],encapsulation:2});let e=o;return e})();var St=(()=>{let o=class o{constructor(n){this.http=n}getAll(n){return this.http.get(`/articles/${n}/comments`).pipe(w(i=>i.comments))}add(n,i){return this.http.post(`/articles/${n}/comments`,{comment:{body:i}}).pipe(w(s=>s.comment))}delete(n,i){return this.http.delete(`/articles/${i}/comments/${n}`)}};o.\u0275fac=function(i){return new(i||o)(O(tt))},o.\u0275prov=H({token:o,factory:o.\u0275fac,providedIn:"root"});let e=o;return e})();var bt=e=>["/editor",e],wt=e=>({disabled:e}),kt=()=>["/login"],Vt=()=>["/register"];function It(e,o){if(e&1){let t=C();a(0,"span")(1,"a",15),d(2,"i",16),m(3," Edit Article "),l(),a(4,"button",17),f("click",function(){u(t);let i=p(2);return _(i.deleteArticle())}),d(5,"i",18),m(6," Delete Article "),l()()}if(e&2){let t=p(2);r(),c("routerLink",h(2,bt,t.article.slug)),r(3),c("ngClass",h(4,wt,t.isDeleting))}}function Dt(e,o){if(e&1){let t=C();a(0,"span")(1,"app-follow-button",19),f("toggle",function(i){u(t);let s=p(2);return _(s.toggleFollowing(i))}),l(),a(2,"app-favorite-button",20),f("toggle",function(i){u(t);let s=p(2);return _(s.onToggleFavorite(i))}),m(3),a(4,"span",21),m(5),l()()()}if(e&2){let t=p(2);r(),c("profile",t.article.author),r(),c("article",t.article),r(),v(" ",t.article.favorited?"Unfavorite":"Favorite"," Article "),r(2),v("(",t.article.favoritesCount,")")}}function Lt(e,o){if(e&1&&(a(0,"li",9),m(1),l()),e&2){let t=o.$implicit;r(),v(" ",t," ")}}function Mt(e,o){if(e&1){let t=C();a(0,"span")(1,"a",15),d(2,"i",16),m(3," Edit Article "),l(),a(4,"button",17),f("click",function(){u(t);let i=p(2);return _(i.deleteArticle())}),d(5,"i",18),m(6," Delete Article "),l()()}if(e&2){let t=p(2);r(),c("routerLink",h(2,bt,t.article.slug)),r(3),c("ngClass",h(4,wt,t.isDeleting))}}function Ut(e,o){if(e&1){let t=C();a(0,"span")(1,"app-follow-button",19),f("toggle",function(i){u(t);let s=p(2);return _(s.toggleFollowing(i))}),l(),a(2,"app-favorite-button",20),f("toggle",function(i){u(t);let s=p(2);return _(s.onToggleFavorite(i))}),m(3),a(4,"span",21),m(5),l()()()}if(e&2){let t=p(2);r(),c("profile",t.article.author),r(),c("article",t.article),r(),v(" ",t.article.favorited?"Unfavorite":"Favorite"," Article "),r(2),v("(",t.article.favoritesCount,")")}}function jt(e,o){if(e&1){let t=C();a(0,"div"),d(1,"app-list-errors",22),a(2,"form",23),f("ngSubmit",function(){u(t);let i=p(2);return _(i.addComment())}),a(3,"fieldset",24)(4,"div",25),d(5,"textarea",26),l(),a(6,"div",27),d(7,"img",28),a(8,"button",29),m(9," Post Comment "),l()()()()()}if(e&2){let t=p(2);r(),c("errors",t.commentFormErrors),r(2),c("disabled",t.isSubmitting),r(2),c("formControl",t.commentControl),r(2),c("src",(t.currentUser==null?null:t.currentUser.image)===null?"":t.currentUser==null?null:t.currentUser.image,k)}}function Rt(e,o){e&1&&(a(0,"div")(1,"a",30),m(2,"Sign in"),l(),m(3," or "),a(4,"a",30),m(5,"sign up"),l(),m(6," to add comments on this article. "),l()),e&2&&(r(),c("routerLink",R(2,kt)),r(3),c("routerLink",R(3,Vt)))}function Nt(e,o){if(e&1){let t=C();a(0,"app-article-comment",31),f("delete",function(){let i=u(t).$implicit,s=p(2);return _(s.deleteComment(i))}),l()}if(e&2){let t=o.$implicit;c("comment",t)}}function $t(e,o){if(e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),m(4),l(),a(5,"app-article-meta",3),g(6,It,7,6,"span")(7,Dt,6,4,"span"),l()()(),a(8,"div",4)(9,"div",5)(10,"div",6),d(11,"div",7),b(12,"markdown"),b(13,"async"),a(14,"ul",8),U(15,Lt,2,1,"li",9,M),l()()(),d(17,"hr"),a(18,"div",10)(19,"app-article-meta",3),g(20,Mt,7,6,"span")(21,Ut,6,4,"span"),l()(),a(22,"div",11)(23,"div",12),g(24,jt,10,4,"div",13)(25,Rt,7,4,"div",13),U(26,Nt,1,1,"app-article-comment",14,M),l()()()()),e&2){let t=p();r(4),Q(t.article.title),r(),c("article",t.article),r(),x(t.canModify?6:7),r(5),c("innerHTML",A(13,10,A(12,8,t.article.body)),K),r(4),j(t.article.tagList),r(4),c("article",t.article),r(),x(t.canModify?20:21),r(4),c("ifAuthenticated",!0),r(),c("ifAuthenticated",!1),r(),j(t.comments)}}var we=(()=>{let o=class o{constructor(n,i,s,F,At){this.route=n,this.articleService=i,this.commentsService=s,this.router=F,this.userService=At,this.comments=[],this.canModify=!1,this.commentControl=new dt("",{nonNullable:!0}),this.commentFormErrors=null,this.isSubmitting=!1,this.isDeleting=!1,this.destroyRef=y(W)}ngOnInit(){let n=this.route.snapshot.params.slug;z([this.articleService.get(n),this.commentsService.getAll(n),this.userService.currentUser]).pipe(P(i=>(this.router.navigate(["/"]),B(()=>i))),E(this.destroyRef)).subscribe(([i,s,F])=>{this.article=i,this.comments=s,this.currentUser=F,this.canModify=F?.username===i.author.username})}onToggleFavorite(n){this.article.favorited=n,n?this.article.favoritesCount++:this.article.favoritesCount--}toggleFollowing(n){this.article.author.following=n.following}deleteArticle(){this.isDeleting=!0,this.articleService.delete(this.article.slug).pipe(E(this.destroyRef)).subscribe(()=>{this.router.navigate(["/"])})}addComment(){this.isSubmitting=!0,this.commentFormErrors=null,this.commentsService.add(this.article.slug,this.commentControl.value).pipe(E(this.destroyRef)).subscribe({next:n=>{this.comments.unshift(n),this.commentControl.reset(""),this.isSubmitting=!1},error:n=>{this.isSubmitting=!1,this.commentFormErrors=n}})}deleteComment(n){this.commentsService.delete(n.id,this.article.slug).pipe(E(this.destroyRef)).subscribe(()=>{this.comments=this.comments.filter(i=>i!==n)})}};o.\u0275fac=function(i){return new(i||o)(S(it),S(at),S(St),S(nt),S(L))},o.\u0275cmp=T({type:o,selectors:[["app-article-page"]],standalone:!0,features:[V],decls:1,vars:1,consts:[[1,"article-page"],[1,"banner"],[1,"container"],[3,"article"],[1,"container","page"],[1,"row","article-content"],[1,"col-md-12"],[3,"innerHTML"],[1,"tag-list"],[1,"tag-default","tag-pill","tag-outline"],[1,"article-actions"],[1,"row"],[1,"col-xs-12","col-md-8","offset-md-2"],[4,"ifAuthenticated"],[3,"comment"],[1,"btn","btn-sm","btn-outline-secondary",3,"routerLink"],[1,"ion-edit"],[1,"btn","btn-sm","btn-outline-danger",3,"click","ngClass"],[1,"ion-trash-a"],[3,"toggle","profile"],[3,"toggle","article"],[1,"counter"],[3,"errors"],[1,"card","comment-form",3,"ngSubmit"],[3,"disabled"],[1,"card-block"],["placeholder","Write a comment...","rows","3",1,"form-control",3,"formControl"],[1,"card-footer"],[1,"comment-author-img",3,"src"],["type","submit",1,"btn","btn-sm","btn-primary"],[3,"routerLink"],[3,"delete","comment"]],template:function(i,s){i&1&&g(0,$t,28,12,"div",0),i&2&&x(s.article?0:-1)},dependencies:[rt,D,Y,gt,lt,ht,I,Ct,ft,ut,ct,mt,st,pt,yt,vt,_t,ot],encapsulation:2});let e=o;return e})();export{we as default};
